name: Display MsTest helper

on:
  push:
    branches: [ main ]
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v2
               
     # - name: setup-msbuild
     #   uses: microsoft/setup-msbuild@v1.1
      
      - name: Setup NuGet.exe for use with actions
        uses: NuGet/setup-nuget@v1.0.5
      
      - name: Restore NuGet Packages
        run: nuget restore ./dotnetMVC/dotnetMVC.sln
      
      - name: Dependency - MSBuild
        uses: microsoft/setup-msbuild@v1.1
        with:
          vswhere-path: 'C:\Program Files (x86)\Microsoft Visual Studio\Installer'  

      - name: Run MStest 
        run: '$x = ""; dir *\bin\*test*.dll -Recurse | foreach { $x += "/testcontainer:""$_"" " }; iex "$(vswhere -property installationPath)\Common7\IDE\MSTest.exe $x"'
      #- name: Run a one-line script
      #  run:  '& "$(vswhere -property installationPath)\Common7\IDE\MSTest.exe" /help'
